CREATE TABLE EMSD_DETALLE_VENTA_SERVICIO(
	COD_VENTA NUMBER,
	COD_SERVICIO NUMBER,
	CONSTRAINT FK_EMSD_DETALLE_SERVICIO_VENTA_SERVICIO FOREIGN KEY (COD_SERVICIO) REFERENCES EMSD_SERVICIOS(COD_SERVICIO),
	CONSTRAINT FK_EMSD_DETALLE_SERVICIO_VENTA_VENTA FOREIGN KEY (COD_VENTA) REFERENCES EMSD_VENTA(COD_VENTA),	
	CONSTRAINT PK_DETALLE_SERVICIOS_VENTA PRIMARY KEY(COD_VENTA, COD_SERVICIO)
)

CREATE OR REPLACE PROCEDURE EMSD_DETALLE_SERVICIOS_VENTA_INSERT(
	P_OPCION VARCHAR2,
	P_COD_VENTA NUMBER,
	P_COD_SERVICIO NUMBER
)
IS 
BEGIN
    LOCK TABLE EMSD_DETALLE_VENTA_SERVICIO IN ROW EXCLUSIVE MODE;
    IF (UPPER(P_OPCION) = 'INSERT') THEN
        INSERT INTO EMSD_DETALLE_VENTA_SERVICIO(COD_VENTA, COD_SERVICIO)
            VALUES(P_COD_VENTA, P_COD_SERVICIO);
    END IF;
    COMMIT;
    EXCEPTION
        WHEN NO_DATA_FOUND THEN
            RAISE_APPLICATION_ERROR(+100, 'No tenemos registrada este detalle de venta y servicio');
        WHEN STORAGE_ERROR THEN
            RAISE_APPLICATION_ERROR(-6500, 'Fallo de memoria');
    ROLLBACK;
END;
