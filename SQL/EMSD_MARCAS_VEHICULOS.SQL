CREATE TABLE EMSD_MARCAS_VEHICULOS(
    COD_MARCA_VEHICULO NUMBER,
    NOMBRE_MARCA_VEHICULO VARCHAR2(30),
    CONSTRAINT PK_EMSD_MARCAS_VEHICULOS PRIMARY KEY(COD_MARCA_VEHICULO)
);

CREATE OR REPLACE TRIGGER EMSD_MARCAS_VEHICULO
BEFORE INSERT
ON EMSD_MARCAS_VEHICULOS
FOR EACH ROW
BEGIN
	SELECT MAX(COD_MARCA_VEHICULO)+1 INTO :NEW.COD_MARCA_VEHICULO
	FROM EMSD_MARCAS_VEHICULOS;
	IF(:NEW.COD_MARCA_VEHICULO IS NULL)THEN
		:NEW.COD_MARCA_VEHICULO := 1;
	END IF;
END;

CREATE OR REPLACE PROCEDURE EMSD_VEHICULOS_CRUD(
	P_OPCION VARCHAR2,
    P_COD_VEHICULO NUMBER,
	P_NOMBRE_MARCA VARCHAR2
)
IS 
BEGIN
	LOCK TABLE EMSD_MARCAS_VEHICULOS IN ROW EXCLUSIVE MODE;
	IF(P_OPCION = 'INSERT') THEN
        INSERT INTO EMSD_MARCAS_VEHICULOS(NOMBRE_MARCA_VEHICULO)
        	VALUES(UPPER(P_NOMBRE_MARCA));
    END IF;
    IF(P_OPCION = 'DELETE') THEN
            DELETE FROM EMSD_MARCAS_VEHICULOS WHERE COD_MARCA_VEHICULO = P_COD_VEHICULO;    	
    END IF;
	COMMIT;
	EXCEPTION
		WHEN NO_DATA_FOUND THEN
    		RAISE_APPLICATION_ERROR(+100, 'No existe esta marca de vehiculo');
    	WHEN STORAGE_ERROR THEN
            RAISE_APPLICATION_ERROR(-6500, 'Fallo de memoria');
    ROLLBACK;
END;
